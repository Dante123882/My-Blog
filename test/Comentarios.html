<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Recibe y limpia los datos del formulario
    $nombre = htmlspecialchars(trim($_POST['nombre']));
    $correo = filter_var(trim($_POST['correo']), FILTER_SANITIZE_EMAIL);
    $mensaje = htmlspecialchars(trim($_POST['mensaje']));
    
    // Verifica que los campos no estén vacíos
    if (!empty($nombre) && !empty($correo) && !empty($mensaje)) {
        // Formatea la información del comentario
        $fecha = date('d-m-Y H:i:s');
        $comentario = "--- Nuevo Comentario ---\n";
        $comentario .= "Fecha: " . $fecha . "\n";
        $comentario .= "Nombre: " . $nombre . "\n";
        $comentario .= "Correo: " . $correo . "\n";
        $comentario .= "Mensaje: " . $mensaje . "\n\n";
        
        // Guarda el comentario en un archivo de texto
        $archivo = 'comentarios.txt';
        file_put_contents($archivo, $comentario, FILE_APPEND | LOCK_EX);
        
        // Redirige al usuario de vuelta al blog con un mensaje de éxito
        header('Location: SH2.php?success=1');
        exit();
    } else {
        // Redirige con un mensaje de error si los campos están vacíos
        header('Location: SH2.php?error=1');
        exit();
    }
} else {
    // Si la página se accede directamente sin enviar el formulario, redirige
    header('Location: SH2.php');
    exit();
}
?>